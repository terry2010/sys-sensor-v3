# 项目任务说明

 本项目目标：在 Windows 上模仿 iStat Menus，采集并展示电脑各项系统指标。

 所有指标清单与定义参见：[`doc/istat-menus-metrics.md`](./istat-menus-metrics.md)

 ---

 ## 技术栈
 1. C# 后台服务：采集与监控所有指标
 2. Tauri 2.x + Vue 3 + TypeScript 前端：负责展示指标
 3. 前后端通信：Named Pipes + JSON-RPC 2.0
 4. 数据对外与持久化（通信/存储）统一使用 `snake_case`，代码内部遵循各语言惯例

 ## 开发环境
 1. Windows 10
 2. Visual Studio 2022
 3. Tauri 2.x
 4. Vue 3
 5. TypeScript
 6. PowerShell（多个命令以分号 `;` 连接）

 ## 功能模块
 1. 后台服务（C#）
    - 负责采集和监控所有指标。
    - 当检测到前端程序退出或关闭时，进入“极低耗模式”（不采集任何数据）。
    - 提供接口/命令：列出所有指标的最新数据。
    - 运行方式：
      - 作为 Windows 服务运行；
      - 作为控制台程序运行。

 2. 前端界面（Tauri 2.x + Vue 3 + TypeScript）
    - 界面列表：
      1) 可播放动画的系统托盘图标，支持自定义右键菜单；
      2) 悬浮窗口：展示配置好的特定数据；
      3) 贴边窗口；
      4) 设置窗口：配置指标展示、宠物脚本、主题等；
      5) 调试窗口：显示调试信息，精细到每个指标的采集时间与参数；
      6) 调试用数据展示窗口：显示从 C# 服务接收到的全部数据；
      7) 互动动画窗口：展示桌面宠物，可按脚本全屏移动并进行互动；
      8) 数据展示窗口：展示各类指标数据（可多窗口，数量与内容由用户配置）；
      9) 统一的“最新一次所有指标数据”的存取点，便于所有进程与服务读取；
      10) 24 小时历史数据存储，用于绘图。

 3. 桌面宠物功能
    - 可以播放动画与互动动画；
    - 支持脚本驱动；
    - 可根据指标或用户输入触发特定动画；
    - 示例：
      > 卡通宠物猫可贴边隐藏；鼠标触至贴边条时伸出猫爪招手；
      > 用户点击后弹出，与用户互动。若用户长时间不动鼠标，突然移动时，
      > 猫会像追逐激光点一样扑腾；随后回到贴边隐藏。
      > 当 CPU 温度过高时，猫会跳出并播放“满身大汗”的动画。

 ## 更新逻辑
 - 支持每日/每周/每月检查更新；
 - 静默下载；
 - 用户点击确认后，客户端重启完成更新；
 - 更新过程中避免触发 UAC。

 ## 开发调试
 - 开发/调试阶段可直接启动，不依赖安装 Windows 服务。

 ## 开发计划（粗略）
 1. 开发 C# 后台服务；
 2. 开发前端的“调试窗口 + 调试用数据展示窗口”，校验数据链路；
 3. 开发前端的“设置窗口、托盘图标、悬浮窗口、数据展示窗口”；
 4. 开发前端的“互动动画窗口（桌面宠物）”。

 ## 开发要求
 1. 代码必须有详细中文注释；
 2. 每个指标与功能点必须有对应的单元测试；
 3. 完成标准：功能运行正常且单元测试通过；
 4. 代码需模块化、职责清晰；单文件原则上不超过 300 行；
 5. 单文件功能需单一，避免无关功能混杂。

 ## 架构设计
 1. 数据采集层：1 秒频率采集，支持动态调整；
 2. 数据存储层：内存 + SQLite 混合存储；
 3. 通信层：Named Pipes + JSON-RPC 2.0；
 4. 展示层：多窗口 Vue 组件；
 5. 配置层：JSON 配置文件 + 热重载。

 ## 数据管理
 1. 实时数据缓存：内存存储最新一次所有指标；
 2. 历史数据存储：SQLite 滚动存储 24 小时数据；
 3. 数据访问 API：统一的数据读取接口；
 4. 数据同步机制：确保多窗口数据一致。