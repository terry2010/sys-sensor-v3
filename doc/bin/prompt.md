# 项目任务说明

 本项目目标：在 Windows 上模仿 iStat Menus，采集并展示电脑各项系统指标。

 ### 功能涵盖：
1. 完成文档 C:\code\sys-sensor-v3\doc\istat-menus-metrics.md 中所有指标监测
2. 历史数据图表展示， 包括但不限于 top进程cpu占用图表，top进程内存占用，top进程硬盘读写，电脑风扇转速
3. 拥有可以隐藏显示的贴边窗口，悬浮窗口，系统托盘图标，设置窗口，多个指标展示窗口。 鼠标经过后会显示类似istat menu 的指标展示窗口，
4. 电子宠物功能，有可以和用户交互的卡通猫， 默认会在启动后打个招呼，然后在贴边窗口上开一个门，进贴边窗口内部休息。 当用户放在贴边窗口热区的时候， 会伸出爪子抓鼠标玩。 间隔随机时间后，会从贴边窗口里出来满屏幕跑一会
5. 这个软件拥有创意工厂， 可以一键更换软件主题， 更换宠物（比如猫换狗换驴）。可以像istat menu一样自定义指标展示窗口的展示细节

 ---

 ## 技术栈
 1. C# 后台服务：采集与监控所有指标
 2. Tauri 2.x + Vue 3 + TypeScript 前端：负责展示指标
 3. 前后端通信：Named Pipes + JSON-RPC 2.0
 4. 数据对外与持久化（通信/存储）统一使用 `snake_case`，代码内部遵循各语言惯例

 ## 开发环境
 1. Windows 10
 2. Visual Studio 2022
 3. Tauri 2.x
 4. Vue 3
 5. TypeScript
 6. PowerShell（多个命令以分号 `;` 连接）

 ## 功能模块
 1. 后台服务（C#）
    - 负责采集和监控所有指标。
    - 当检测到前端程序退出或关闭时，进入“极低耗模式”（不采集任何数据）。
    - 提供接口/命令：列出所有指标的最新数据。
    - 运行方式：
      - 作为 Windows 服务运行；
      - 作为控制台程序运行。

 2. 前端界面（Tauri 2.x + Vue 3 + TypeScript）
    - 界面列表：
      1) 可播放动画的系统托盘图标，支持自定义右键菜单；
      2) 悬浮窗口：展示配置好的特定数据；
      3) 贴边窗口；
      4) 设置窗口：配置指标展示、宠物脚本、主题等；
      5) 调试窗口：显示调试信息，精细到每个指标的采集时间与参数；
      6) 调试用数据展示窗口：显示从 C# 服务接收到的全部数据；
      7) 互动动画窗口：展示桌面宠物，可按脚本全屏移动并进行互动；
      8) 数据展示窗口：展示各类指标数据（可多窗口，数量与内容由用户配置）；
      9) 统一的“最新一次所有指标数据”的存取点，便于所有进程与服务读取；
      10) 24 小时历史数据存储，用于绘图。

 3. 桌面宠物功能
    - 可以播放动画与互动动画；
    - 支持脚本驱动；
    - 可根据指标或用户输入触发特定动画；
    - 示例：
      > 卡通宠物猫可贴边隐藏；鼠标触至贴边条时伸出猫爪招手；
      > 用户点击后弹出，与用户互动。若用户长时间不动鼠标，突然移动时，
      > 猫会像追逐激光点一样扑腾；随后回到贴边隐藏。
      > 当 CPU 温度过高时，猫会跳出并播放“满身大汗”的动画。

 ## 更新逻辑
 - 支持每日/每周/每月检查更新；
 - 静默下载；
 - 用户点击确认后，客户端重启完成更新；
 - 更新过程中避免触发 UAC。

 ## 开发调试
 - 开发/调试阶段可直接启动，不依赖安装 Windows 服务。

 ## 开发计划（粗略）
 1. 开发 C# 后台服务；
 2. 开发前端的“调试窗口 + 调试用数据展示窗口”，校验数据链路；
 3. 开发前端的“设置窗口、托盘图标、悬浮窗口、数据展示窗口”；
 4. 开发前端的“互动动画窗口（桌面宠物）”。

 ## 开发要求
 1. 代码必须有详细中文注释；
 2. 每个指标与功能点必须有对应的单元测试；
 3. 完成标准：功能运行正常且单元测试通过；
 4. 代码需模块化、职责清晰；单文件原则上不超过 300 行；
 5. 单文件功能需单一，避免无关功能混杂。

 ## 架构设计
 1. 数据采集层：1 秒频率采集，支持动态调整；
 2. 数据存储层：内存 + SQLite 混合存储；
 3. 通信层：Named Pipes + JSON-RPC 2.0；
 4. 展示层：多窗口 Vue 组件；
 5. 配置层：JSON 配置文件 + 热重载。

 ## 数据管理
 1. 实时数据缓存：内存存储最新一次所有指标；
 2. 历史数据存储：SQLite 滚动存储 24 小时数据；
 3. 数据访问 API：统一的数据读取接口；
 4. 数据同步机制：确保多窗口数据一致。


 # 你的任务：



 完整查阅文档， 完整审阅代码，总结项目现状 

总结完毕后， 再读一次 C:\code\sys-sensor-v3\doc\task.md 和  C:\code\sys-sensor-v3\doc\istat-menus-metrics.md ， 

从现在开始你要专注于逐项实现  C:\code\sys-sensor-v3\doc\istat-menus-metrics.md  中的指标。 开发每一个指标的流程为：

将准备开发的指标写入todo文档 -》修改后端代码增加指标采集数据-》反复尝试编译，并反复修改问题代码，直到编译成功为止-》修改测试代码，反复运行测试，直到测试全部通过为止-》 在tauri 前端增加相应指标显示，在主进程中打印指标数据 -》 使用 dev.ps1 启动整个程序，确认程序能启动，主进程中打印数据符合预期-》 注释掉tauri主进程打印数据的代码 

每次开发完一个指标，就要重读 C:\code\sys-sensor-v3\doc\istat-menus-metrics.md ，  确认自己开发的指标没有问题， 确认下一项开发指标内容和细节

 



##  工作流程（逐指标落实）


1) 在 `doc/todo-2025-08-22.md` 补充并勾选内存指标的字段与来源说明。
2) 修改后端
3) 反复编译，直到通过。
4) 修改/新增测试并反复运行，直到通过。
5) 前端（Tauri）临时在主进程打印该指标并展示。 
6) 确定在主窗口中正常显示指标后，使用 `scripts/dev.ps1` 启动联调，确认打印值合理。
7) 注释掉主进程打印。
8) 重读 `doc/istat-menus-metrics.md`，选择下一项。













这次集中力量将传感器与风扇所有指标都实现了。 之前你要先总结相关需要开发指标，总结完以后， 你重新和  C:\code\sys-sensor-v3\doc\istat-menus-metrics.md  对比一下， 确定没有遗漏指标。然后进入开发 